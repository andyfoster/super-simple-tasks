$(document).ready(function(){var a,b;return b=$("#new-task"),a=function(){var a;return a=Task.getAllTasks(),Views.showTasks(a),b.focus(),$("body").css("opacity","100")},$("#task-submit").click(function(a){var c;return a.preventDefault(),c=b.val(),Task.setNewTask(c),$("#new-task").val("")}),$("#mark-all-done").click(function(a){var b;return a.preventDefault(),b=Task.getAllTasks(),0===b.length?confirm("No tasks to mark done!"):confirm("Are you sure you want to mark all tasks as done?")?Task.markAllDone():void 0}),$("#undo").click(function(){return Task.undoLast()}),$(document).on("click","#task-list li label input",function(){var a;return a=$(this).closest("li"),a.hide(function(){return Task.markDone(Views.getId(a))})}),$(document).on("click",".priority, .duedate",function(a){var b,c,d;return c=$(a.currentTarget).attr("type"),d=$(this).attr(c),b=$(this).closest("li"),Task.changeAttr(b,c,d)}),a()});var Arrays,DB,Task;DB=function(){function a(){}return a.db_key="todo",a}(),Arrays=function(){function a(){}return a.priorities=["minor","major","blocker"],a.duedates=["today","tomorrow","this week","next week","this month"],a.default_data=[{isDone:!1,name:"Add a new task above",priority:"major",duedate:"today"},{isDone:!1,name:"Refresh and see your task is still here",priority:"minor",duedate:"today"},{isDone:!1,name:"Click a task to complete it",priority:"minor",duedate:"tomorrow"},{isDone:!1,name:'Follow <a href="http://twitter.com/humphreybc" target="_blank">@humphreybc</a> on Twitter',priority:"major",duedate:"today"}],a}(),Task=function(){function a(){}return a.getAllTasks=function(){var a;return a=localStorage.getItem(DB.db_key),a=JSON.parse(a)||Arrays.default_data},a.createTask=function(a){var b;return b={isDone:!1,name:a,priority:"minor",duedate:"today"}},a.setNewTask=function(a){var b,c;return""!==a?(c=this.createTask(a),b=this.getAllTasks(),b.push(c),this.setAllTasks(b)):void 0},a.setAllTasks=function(a){return localStorage.setItem(DB.db_key,JSON.stringify(a)),Views.showTasks(a)},a.changeAttr=function(a,b,c){var d,e;return"priority"===b?d=Arrays.priorities:"duedate"===b&&(d=Arrays.duedates),e=$.inArray(c,d),e===d.length-1&&(e=-1),c=d[e+1],this.updateAttr(a,b,c)},a.updateAttr=function(a,b,c){var d,e,f;return e=Views.getId(a),d=this.getAllTasks(),f=d[e],f[b]=c,this.setAllTasks(d)},a.undoLast=function(){var a,b,c;return c=localStorage.getItem("undo"),c=JSON.parse(c),a=this.getAllTasks(),b=c.position,delete c.position,a.splice(b,0,c),this.setAllTasks(a),localStorage.removeItem("undo"),Views.undoUX(a)},a.markDone=function(a){var b,c;return b=this.getAllTasks(),c=b[a],c.position=a,localStorage.setItem("undo",JSON.stringify(c)),Views.undoFade(),b=this.getAllTasks(),b.splice(a,1),this.setAllTasks(b)},a.markAllDone=function(){var a;return this.setAllTasks([]),a=this.getAllTasks(),Views.showTasks(a)},a}();var Views;Views=function(){function a(){}var b;return b=0,a.getId=function(a){var b;return b=$(a).find("input").attr("id").replace("task",""),parseInt(b)},a.generateHTML=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=a.length;f>e;b=++e)c=a[b],d[b]='<li><label><input type="checkbox" id="task'+b+'" />'+c.name+'</label><a class="duedate" type="duedate" duedate="'+c.duedate+'">'+c.duedate+'</a><a class="priority" type="priority" priority="'+c.priority+'">'+c.priority+"</a></li>";return d},a.showTasks=function(a){var b;return b=this.generateHTML(a),$("#task-list").html(b),0===a.length?($("#all-done").show(),$("#new-task").focus()):$("#all-done").hide()},a.undoFade=function(){return $("#undo").fadeIn(),b=setTimeout(function(){return $("#undo").fadeOut(),localStorage.removeItem("undo")},5e3)},a.undoUX=function(a){return this.showTasks(a),clearTimeout(b),$("#undo").css("opacity","0")},a}();