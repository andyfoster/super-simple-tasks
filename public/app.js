// Generated by CoffeeScript 1.3.3

$(document).ready(function() {
  var createToDo, generateHTML, getAllTodos, getId, getNames, initialize, markDone, setAllTodos, setNewTodo, showTodos;
  initialize = function() {
    var allTodos;
    allTodos = getAllTodos();
    showTodos(allTodos);
    return $("#new-todo").focus();
  };
  getAllTodos = function() {
    var todo;
    todo = localStorage.getItem("todo");
    todo = JSON.parse(todo) || [];
    return todo;
  };
  setNewTodo = function() {
    var allTodos, name, newTodo;
    name = $("#new-todo").val();
    newTodo = createToDo(name);
    allTodos = getAllTodos();
    allTodos.push(newTodo);
    return setAllTodos(allTodos);
  };
  setAllTodos = function(allTodos) {
    localStorage.setItem("todo", JSON.stringify(allTodos));
    showTodos(allTodos);
    return $("#new-todo").val('');
  };
  getId = function(li) {
    var id;
    id = $(li).find('input').attr('id').replace('todo', '');
    return parseInt(id);
  };
  markDone = function(id) {
    var todos;
    todos = getAllTodos();
    todos.splice(id, 1);
    return setAllTodos(todos);
  };
  createToDo = function(name) {
    var todo;
    return todo = {
      isDone: false,
      name: name
    };
  };
  showTodos = function(allTodos) {
    var html;
    html = generateHTML(allTodos);
    return $("#todo-list").html(html);
  };
  generateHTML = function(allTodos) {
    var i, name, names, _i, _len;
    names = getNames(allTodos);
    for (i = _i = 0, _len = names.length; _i < _len; i = ++_i) {
      name = names[i];
      names[i] = '<li><input type="checkbox" id="todo' + i + '"></input><label for=todo' + i + '>' + name + '</label></li>';
    }
    return names;
  };
  getNames = function(allTodos) {
    var names, todo, _i, _len;
    names = [];
    for (_i = 0, _len = allTodos.length; _i < _len; _i++) {
      todo = allTodos[_i];
      names.push(todo['name']);
    }
    return names;
  };
  initialize();
  $("#todo-submit").click(function(e) {
    e.preventDefault();
    return setNewTodo();
  });
  return $(document).on("click", "#todo-list li", function(e) {
    return markDone(getId(this));
  });
});
